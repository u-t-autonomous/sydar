%dymanics
A = [1.0000e+00 2.0000e+00 ; 4.5000e+01 7.0000e+00 ];
B = [1.0000e+00 ; 2.0000e+00 ];
n = 2;
m = 1;
Q = [1.0000e+00 ];
R = [1.0000e+00 ];
x0 = [1.0000e+00 ; 2.0000e+00 ];
xf = [2.0000e+00 ; 5.0000e+00 ];
%state transition cost
s = 1;
%number of states
Nq = 4;
cvx_begin sdp;
	 variable P(n,n,Nq);
	 variable r(n,1,Nq);
	 variable t(1,Nq);
	 variable tau(19,1);
	 maximize( quad_form(x0,P(:,:,1)) + 2*r(:,:,1)'*x0 + t(:,1) );
	 for i=1:Nq
		 P(:,:,i) == semidefinite(n);
	 end
	 tau(:) >= 0;
%q_3 

	 0 <= [A'*P(:,:,4) + P(:,:,4)'*A + Q, P(:,:,4)*B,  A'*r(:,:,4); ...
	       B'*P(:,:,4)',                  R,           B'*r(:,:,4); ...
	       r(:,:,4)'*A,                   r(:,:,4)'*B, 0  ]...
		- tau(1)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]]...
		- tau(2)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]];

	 0 <= [A'*P(:,:,4) + P(:,:,4)'*A + Q, P(:,:,4)*B,  A'*r(:,:,4); ...
	       B'*P(:,:,4)',                  R,           B'*r(:,:,4); ...
	       r(:,:,4)'*A,                   r(:,:,4)'*B, 0  ]...
		- tau(3)*[zeros(n), zeros(n,m), 0.5*[1.0000e+00 2.0000e+00 ]' ; zeros(m,n), zeros(m), 0; 0.5*[1.0000e+00 2.0000e+00 ], zeros(1,m), -1*48];
%q_2 

	 0 <= [A'*P(:,:,3) + P(:,:,3)'*A + Q, P(:,:,3)*B,  A'*r(:,:,3); ...
	       B'*P(:,:,3)',                  R,           B'*r(:,:,3); ...
	       r(:,:,3)'*A,                   r(:,:,3)'*B, 0  ]...
		- tau(4)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]]...
		- tau(5)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]];

	 0 <= [A'*P(:,:,3) + P(:,:,3)'*A + Q, P(:,:,3)*B,  A'*r(:,:,3); ...
	       B'*P(:,:,3)',                  R,           B'*r(:,:,3); ...
	       r(:,:,3)'*A,                   r(:,:,3)'*B, 0  ]...
		- tau(6)*[zeros(n), zeros(n,m), 0.5*[1.0000e+00 2.0000e+00 ]' ; zeros(m,n), zeros(m), 0; 0.5*[1.0000e+00 2.0000e+00 ], zeros(1,m), -1*48];
%q_1 

	 0 <= [A'*P(:,:,2) + P(:,:,2)'*A + Q, P(:,:,2)*B,  A'*r(:,:,2); ...
	       B'*P(:,:,2)',                  R,           B'*r(:,:,2); ...
	       r(:,:,2)'*A,                   r(:,:,2)'*B, 0  ]...
		- tau(7)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]]...
		- tau(8)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]];

	 0 <= [A'*P(:,:,2) + P(:,:,2)'*A + Q, P(:,:,2)*B,  A'*r(:,:,2); ...
	       B'*P(:,:,2)',                  R,           B'*r(:,:,2); ...
	       r(:,:,2)'*A,                   r(:,:,2)'*B, 0  ]...
		- tau(9)*[zeros(n), zeros(n,m), 0.5*[1.0000e+00 2.0000e+00 ]' ; zeros(m,n), zeros(m), 0; 0.5*[1.0000e+00 2.0000e+00 ], zeros(1,m), -1*48];
%q_0 

	 0 <= [A'*P(:,:,1) + P(:,:,1)'*A + Q, P(:,:,1)*B,  A'*r(:,:,1); ...
	       B'*P(:,:,1)',                  R,           B'*r(:,:,1); ...
	       r(:,:,1)'*A,                   r(:,:,1)'*B, 0  ]...
		- tau(10)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]]...
		- tau(11)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]];

	 0 <= [A'*P(:,:,1) + P(:,:,1)'*A + Q, P(:,:,1)*B,  A'*r(:,:,1); ...
	       B'*P(:,:,1)',                  R,           B'*r(:,:,1); ...
	       r(:,:,1)'*A,                   r(:,:,1)'*B, 0  ]...
		- tau(12)*[zeros(n), zeros(n,m), 0.5*[1.0000e+00 2.0000e+00 ]' ; zeros(m,n), zeros(m), 0; 0.5*[1.0000e+00 2.0000e+00 ], zeros(1,m), -1*48];

%('q_0', 'q_1') 
	 0 <= [P(:,:,2),    r(:,:,2),   zeros(n,1); ...
	       r(:,:,2)',     zeros(m),   zeros(m,1); ...
	       zeros(1,n),    zeros(1,m), t(:,2) + s] ...
	     -[P(:,:,1),    r(:,:,1),   zeros(n,1); ...
	       r(:,:,1)',     zeros(m),   zeros(m,1); ...
	       zeros(1,n),    zeros(1,m), t(:,1) + s] ...
		- tau(13)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]]...
		- tau(14)*[[1.0000e+00 0.0000e+00 ; 0.0000e+00 1.0000e+00 ], zeros(n,1), [1.0000e+00 ; 2.0000e+00 ] ; zeros(m,n), zeros(m), 0; [1.0000e+00 ; 2.0000e+00 ]', zeros(1,1), [[4]]];
%('q_0', 'q_1') 
	 0 <= [P(:,:,2),    r(:,:,2),   zeros(n,1); ...
	       r(:,:,2)',     zeros(m),   zeros(m,1); ...
	       zeros(1,n),    zeros(1,m), t(:,2) + s] ...
	     -[P(:,:,1),    r(:,:,1),   zeros(n,1); ...
	       r(:,:,1)',     zeros(m),   zeros(m,1); ...
	       zeros(1,n),    zeros(1,m), t(:,1) + s] ;
% final 
	quad_form(xf,P(:,:,4)) + 2*r(:,:,4)'*xf + t(:,4) == 0;
cvx_end;
